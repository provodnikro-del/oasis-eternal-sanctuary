<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover"/>
<meta name="apple-mobile-web-app-capable" content="yes"/>
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"/>
<title>Oasis Eternal Sanctuary</title>
<link rel="manifest" href="/manifest.json"/>
<link rel="apple-touch-icon" href="/icons/apple-touch-icon.png"/>
<style>
*{box-sizing:border-box;margin:0;padding:0}
:root{
  --bg:#0a0a14;--surface:#12121f;--surface2:#1a1a2e;
  --text:#e2e8f0;--muted:#64748b;--border:#1e293b;
  --purple:#a78bfa;--blue:#60a5fa;--pink:#f472b6;
  --amber:#f59e0b;--green:#34d399;--orange:#f97316;
}
body{background:var(--bg);color:var(--text);font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',sans-serif;min-height:100vh;overflow-x:hidden}
.screen{display:none;min-height:100vh;padding:env(safe-area-inset-top) 0 env(safe-area-inset-bottom)}
.screen.active{display:flex;flex-direction:column}
/* â”€â”€ Header â”€â”€ */
.header{padding:16px 20px 12px;display:flex;align-items:center;gap:12px;border-bottom:1px solid var(--border)}
.header h1{font-size:18px;font-weight:700;letter-spacing:.5px}
.header .sub{font-size:12px;color:var(--muted);margin-top:2px}
.btn-back{background:none;border:none;color:var(--muted);font-size:20px;cursor:pointer;padding:4px 8px 4px 0}
/* â”€â”€ Cards â”€â”€ */
.card{background:var(--surface);border:1px solid var(--border);border-radius:16px;padding:20px;margin:0 16px 12px}
.card h2{font-size:15px;font-weight:600;margin-bottom:12px}
/* â”€â”€ God Setup â”€â”€ */
.setup-hero{text-align:center;padding:40px 20px 24px}
.setup-hero .emoji{font-size:64px;line-height:1;margin-bottom:16px}
.setup-hero h1{font-size:26px;font-weight:800;background:linear-gradient(135deg,var(--purple),var(--blue));-webkit-background-clip:text;-webkit-text-fill-color:transparent;margin-bottom:8px}
.setup-hero p{color:var(--muted);font-size:14px;line-height:1.6}
.arch-grid{display:grid;grid-template-columns:1fr 1fr;gap:10px;padding:0 16px;margin-bottom:16px}
.arch-card{background:var(--surface);border:2px solid var(--border);border-radius:14px;padding:16px 12px;cursor:pointer;transition:all .2s;text-align:center}
.arch-card.selected{border-color:var(--purple);background:rgba(167,139,250,.1)}
.arch-card .icon{font-size:28px;margin-bottom:6px}
.arch-card .name{font-size:13px;font-weight:600;text-transform:capitalize}
.arch-card .desc{font-size:11px;color:var(--muted);margin-top:3px;line-height:1.4}
.input-row{padding:0 16px;margin-bottom:12px}
.input-row input{width:100%;background:var(--surface);border:1px solid var(--border);border-radius:12px;padding:14px 16px;color:var(--text);font-size:15px;outline:none}
.input-row input:focus{border-color:var(--purple)}
.input-row input::placeholder{color:var(--muted)}
/* â”€â”€ Buttons â”€â”€ */
.btn{width:calc(100% - 32px);margin:0 16px;background:linear-gradient(135deg,var(--purple),var(--blue));border:none;border-radius:14px;padding:16px;color:#fff;font-size:16px;font-weight:700;cursor:pointer;transition:opacity .2s}
.btn:active{opacity:.8}
.btn.secondary{background:var(--surface2);color:var(--text);border:1px solid var(--border)}
.btn.danger{background:rgba(239,68,68,.15);color:#f87171;border:1px solid rgba(239,68,68,.3)}
.btn.sm{width:auto;margin:0;padding:8px 16px;font-size:13px;border-radius:10px}
/* â”€â”€ Sanctuary â”€â”€ */
.god-bar{display:flex;align-items:center;gap:10px;padding:12px 16px;background:var(--surface);border-bottom:1px solid var(--border)}
.god-avatar{width:36px;height:36px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:18px;background:linear-gradient(135deg,var(--purple),var(--blue))}
.god-info .name{font-size:14px;font-weight:600}
.god-info .arch{font-size:11px;color:var(--muted);text-transform:capitalize}
.add-btn{margin-left:auto;background:var(--purple);border:none;border-radius:10px;padding:8px 14px;color:#fff;font-size:13px;font-weight:600;cursor:pointer}
.agents-list{flex:1;overflow-y:auto;padding:12px 0}
.agent-card{background:var(--surface);border:1px solid var(--border);border-radius:16px;margin:0 16px 10px;padding:16px;cursor:pointer;transition:all .2s}
.agent-card:active{transform:scale(.98)}
.agent-top{display:flex;align-items:center;gap:12px;margin-bottom:10px}
.agent-avatar{width:44px;height:44px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:22px}
.agent-meta .name{font-size:15px;font-weight:700}
.agent-meta .arch{font-size:11px;color:var(--muted);text-transform:capitalize;margin-top:2px}
.agent-stats{display:flex;gap:8px}
.stat{flex:1;background:var(--surface2);border-radius:8px;padding:6px 8px;text-align:center}
.stat .val{font-size:14px;font-weight:700}
.stat .lbl{font-size:10px;color:var(--muted);margin-top:1px}
.energy-bar{height:4px;background:var(--border);border-radius:2px;margin-top:8px;overflow:hidden}
.energy-fill{height:100%;border-radius:2px;background:linear-gradient(90deg,var(--green),var(--blue));transition:width .4s}
.mood-chip{display:inline-block;background:rgba(167,139,250,.15);color:var(--purple);border-radius:20px;padding:3px 10px;font-size:11px;margin-top:6px}
.last-msg{font-size:12px;color:var(--muted);margin-top:8px;font-style:italic;line-height:1.4}
.empty-state{text-align:center;padding:48px 32px;color:var(--muted)}
.empty-state .icon{font-size:48px;margin-bottom:12px}
.empty-state p{font-size:14px;line-height:1.6}
/* â”€â”€ Agent Detail â”€â”€ */
.agent-hero{text-align:center;padding:28px 20px 20px}
.agent-hero .avatar{width:80px;height:80px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:40px;margin:0 auto 12px}
.agent-hero .name{font-size:22px;font-weight:800}
.agent-hero .arch{color:var(--muted);font-size:13px;text-transform:capitalize;margin-top:4px}
.agent-hero .gen{font-size:11px;color:var(--muted);margin-top:2px}
.status-row{display:flex;gap:8px;padding:0 16px;margin-bottom:12px}
.status-pill{flex:1;background:var(--surface);border:1px solid var(--border);border-radius:12px;padding:12px;text-align:center}
.status-pill .val{font-size:20px;font-weight:800}
.status-pill .lbl{font-size:10px;color:var(--muted);margin-top:2px}
.care-grid{display:grid;grid-template-columns:1fr 1fr;gap:8px;padding:0 16px;margin-bottom:12px}
.care-btn{background:var(--surface);border:1px solid var(--border);border-radius:14px;padding:16px 12px;cursor:pointer;text-align:center;transition:all .15s}
.care-btn:active{transform:scale(.95)}
.care-btn .ci{font-size:24px;margin-bottom:6px}
.care-btn .ct{font-size:13px;font-weight:600}
.care-btn .cd{font-size:11px;color:var(--muted);margin-top:2px}
.toast{position:fixed;bottom:calc(env(safe-area-inset-bottom) + 20px);left:50%;transform:translateX(-50%) translateY(20px);background:var(--surface2);border:1px solid var(--border);border-radius:12px;padding:12px 20px;font-size:14px;color:var(--text);opacity:0;transition:all .3s;pointer-events:none;white-space:nowrap;z-index:999}
.toast.show{opacity:1;transform:translateX(-50%) translateY(0)}
.traits-grid{display:grid;grid-template-columns:1fr 1fr;gap:6px;margin-top:4px}
.trait-row{display:flex;align-items:center;gap:6px}
.trait-name{font-size:11px;color:var(--muted);width:70px;flex-shrink:0;text-transform:capitalize}
.trait-bar{flex:1;height:6px;background:var(--border);border-radius:3px;overflow:hidden}
.trait-fill{height:100%;border-radius:3px;background:var(--purple)}
/* â”€â”€ Create Agent â”€â”€ */
.arch-small-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:8px;padding:0 16px;margin-bottom:16px}
.arch-sm{background:var(--surface);border:2px solid var(--border);border-radius:12px;padding:12px 8px;cursor:pointer;text-align:center;transition:all .2s}
.arch-sm.selected{border-color:var(--purple);background:rgba(167,139,250,.1)}
.arch-sm .icon{font-size:22px;margin-bottom:4px}
.arch-sm .name{font-size:11px;font-weight:600;text-transform:capitalize}
/* â”€â”€ Loader â”€â”€ */
.loader{text-align:center;padding:40px;color:var(--muted)}
.spinner{width:32px;height:32px;border:3px solid var(--border);border-top-color:var(--purple);border-radius:50%;animation:spin .8s linear infinite;margin:0 auto 12px}
@keyframes spin{to{transform:rotate(360deg)}}
</style>
</head>
<body>

<!-- â•â• SCREEN: SETUP â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div id="screen-setup" class="screen active">
  <div class="setup-hero">
    <div class="emoji">ğŸŒ¿</div>
    <h1>Oasis Eternal Sanctuary</h1>
    <p>Choose your God archetype.<br/>It shapes every soul you bring to life.</p>
  </div>
  <div class="arch-grid" id="setup-arch-grid"></div>
  <div class="input-row">
    <input id="god-name-input" type="text" placeholder="Your God nameâ€¦" maxlength="32"/>
  </div>
  <button class="btn" onclick="createGodProfile()">Enter the Sanctuary â†’</button>
  <div style="height:32px"></div>
</div>

<!-- â•â• SCREEN: SANCTUARY â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div id="screen-sanctuary" class="screen">
  <div class="god-bar">
    <div class="god-avatar" id="sanctuary-god-avatar">âœ¦</div>
    <div class="god-info">
      <div class="name" id="sanctuary-god-name">â€”</div>
      <div class="arch" id="sanctuary-god-arch">â€”</div>
    </div>
    <button class="add-btn" onclick="showScreen('screen-create')">+ Agent</button>
  </div>
  <div class="agents-list" id="agents-list">
    <div class="loader"><div class="spinner"></div>Loading soulsâ€¦</div>
  </div>
</div>

<!-- â•â• SCREEN: CREATE AGENT â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div id="screen-create" class="screen">
  <div class="header">
    <button class="btn-back" onclick="showScreen('screen-sanctuary')">â€¹</button>
    <div><div class="sub">New soul</div><h1>Summon an Agent</h1></div>
  </div>
  <div style="height:16px"></div>
  <div class="card"><h2>Choose Archetype</h2></div>
  <div class="arch-small-grid" id="create-arch-grid"></div>
  <div class="input-row">
    <input id="agent-name-input" type="text" placeholder="Name (optional)â€¦" maxlength="32"/>
  </div>
  <button class="btn" onclick="createAgent()">Summon Soul</button>
  <div style="height:32px"></div>
</div>

<!-- â•â• SCREEN: AGENT DETAIL â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div id="screen-agent" class="screen">
  <div class="header">
    <button class="btn-back" onclick="showScreen('screen-sanctuary')">â€¹</button>
    <div><div class="sub" id="agent-detail-arch">â€”</div><h1 id="agent-detail-name">â€”</h1></div>
  </div>
  <div class="agents-list" id="agent-detail-body">
    <div class="loader"><div class="spinner"></div></div>
  </div>
</div>

<div class="toast" id="toast"></div>

<script>
const API = '';
let godId = localStorage.getItem('oasis_god_id');
let selectedArch_setup = null;
let selectedArch_create = null;
let currentAgentId = null;

const ARCH_META = {
  dreamer:   { icon:'ğŸŒ™', color:'#a78bfa', desc:'Visionary & creative' },
  analyst:   { icon:'âš¡', color:'#60a5fa', desc:'Logical & precise' },
  poet:      { icon:'ğŸŒ¸', color:'#f472b6', desc:'Empathic & expressive' },
  builder:   { icon:'ğŸ”¨', color:'#f59e0b', desc:'Ambitious & loyal' },
  guardian:  { icon:'ğŸ›¡ï¸', color:'#34d399', desc:'Protective & wise' },
  trickster: { icon:'ğŸƒ', color:'#f97316', desc:'Chaotic & clever' },
};

// â”€â”€ Init â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function init() {
  buildArchGrids();
  if (godId) {
    try {
      const p = await api(`/api/god/profile?godId=${godId}`);
      setGodUI(p);
      showScreen('screen-sanctuary');
      loadAgents();
    } catch { localStorage.removeItem('oasis_god_id'); godId = null; }
  }
}

function buildArchGrids() {
  const setupGrid = document.getElementById('setup-arch-grid');
  const createGrid = document.getElementById('create-arch-grid');
  for (const [key, m] of Object.entries(ARCH_META)) {
    setupGrid.innerHTML += `<div class="arch-card" id="setup-arch-${key}" onclick="selectArch('setup','${key}')">
      <div class="icon">${m.icon}</div>
      <div class="name">${key}</div>
      <div class="desc">${m.desc}</div>
    </div>`;
    createGrid.innerHTML += `<div class="arch-sm" id="create-arch-${key}" onclick="selectArch('create','${key}')">
      <div class="icon">${m.icon}</div>
      <div class="name">${key}</div>
    </div>`;
  }
}

// â”€â”€ Screens â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function showScreen(id) {
  document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
  document.getElementById(id).classList.add('active');
  if (id === 'screen-sanctuary') loadAgents();
  if (id === 'screen-agent' && currentAgentId) loadAgentDetail(currentAgentId);
}

// â”€â”€ God Profile â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function selectArch(ctx, key) {
  const prefix = ctx === 'setup' ? 'setup-arch' : 'create-arch';
  document.querySelectorAll(`[id^="${prefix}-"]`).forEach(el => el.classList.remove('selected'));
  document.getElementById(`${prefix}-${key}`)?.classList.add('selected');
  if (ctx === 'setup') selectedArch_setup = key;
  else selectedArch_create = key;
}

async function createGodProfile() {
  const name = document.getElementById('god-name-input').value.trim();
  if (!selectedArch_setup) return toast('Choose an archetype first');
  if (!name) return toast('Enter your God name');
  try {
    const p = await api('/api/god/profile', 'POST', { archetype: selectedArch_setup, name });
    localStorage.setItem('oasis_god_id', p.godId);
    godId = p.godId;
    setGodUI(p);
    showScreen('screen-sanctuary');
    loadAgents();
  } catch(e) { toast('Error: ' + e.message); }
}

function setGodUI(p) {
  const m = ARCH_META[p.archetype] || { icon:'âœ¦', color:'#a78bfa' };
  document.getElementById('sanctuary-god-avatar').textContent = m.icon;
  document.getElementById('sanctuary-god-avatar').style.background = `linear-gradient(135deg,${m.color},${m.color}88)`;
  document.getElementById('sanctuary-god-name').textContent = p.name;
  document.getElementById('sanctuary-god-arch').textContent = p.archetype;
}

// â”€â”€ Agents â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function loadAgents() {
  const list = document.getElementById('agents-list');
  list.innerHTML = '<div class="loader"><div class="spinner"></div>Loading soulsâ€¦</div>';
  try {
    const agents = await api(`/api/agents?godId=${godId}`);
    if (!agents.length) {
      list.innerHTML = `<div class="empty-state">
        <div class="icon">ğŸŒ±</div>
        <p>Your sanctuary is empty.<br/>Summon your first soul to begin.</p>
        <div style="height:16px"></div>
        <button class="btn" onclick="showScreen('screen-create')">+ Summon Agent</button>
      </div>`;
      return;
    }
    list.innerHTML = agents.map(renderAgentCard).join('');
  } catch(e) { list.innerHTML = `<div class="empty-state"><p>Error loading agents</p></div>`; }
}

function renderAgentCard(a) {
  const m = ARCH_META[a.archetype] || { icon:'âœ¦', color:'#a78bfa' };
  return `<div class="agent-card" onclick="openAgent('${a.id}')">
    <div class="agent-top">
      <div class="agent-avatar" style="background:${m.color}22;color:${m.color}">${m.icon}</div>
      <div class="agent-meta">
        <div class="name">${a.name}</div>
        <div class="arch">${a.archetype} Â· Gen ${a.generation} Â· Lv ${a.level}</div>
      </div>
    </div>
    <div class="agent-stats">
      <div class="stat"><div class="val">${a.energy}%</div><div class="lbl">Energy</div></div>
      <div class="stat"><div class="val">${a.level}</div><div class="lbl">Level</div></div>
      <div class="stat"><div class="val" style="font-size:11px;text-transform:capitalize">${a.lifecycleState}</div><div class="lbl">State</div></div>
    </div>
    <div class="energy-bar"><div class="energy-fill" style="width:${a.energy}%"></div></div>
    <div class="mood-chip">âœ¨ ${a.mood}</div>
    ${a.lastMessage ? `<div class="last-msg">"${a.lastMessage}"</div>` : ''}
  </div>`;
}

function openAgent(id) {
  currentAgentId = id;
  showScreen('screen-agent');
}

async function loadAgentDetail(id) {
  const body = document.getElementById('agent-detail-body');
  body.innerHTML = '<div class="loader"><div class="spinner"></div></div>';
  try {
    const a = await api(`/api/agents/${id}`);
    const m = ARCH_META[a.archetype] || { icon:'âœ¦', color:'#a78bfa' };
    document.getElementById('agent-detail-name').textContent = a.name;
    document.getElementById('agent-detail-arch').textContent = `${a.archetype} Â· Gen ${a.generation}`;

    const traitsHtml = Object.entries(a.traits).map(([k,v]) =>
      `<div class="trait-row">
        <div class="trait-name">${k}</div>
        <div class="trait-bar"><div class="trait-fill" style="width:${Math.round(v*100)}%;background:${m.color}"></div></div>
        <div style="font-size:11px;color:var(--muted);width:28px;text-align:right">${Math.round(v*100)}</div>
      </div>`
    ).join('');

    body.innerHTML = `
      <div class="agent-hero">
        <div class="avatar" style="background:${m.color}22;color:${m.color}">${m.icon}</div>
        <div class="name">${a.name}</div>
        <div class="arch">${a.archetype}</div>
        <div class="gen">Generation ${a.generation} Â· Level ${a.level}</div>
      </div>
      <div class="status-row">
        <div class="status-pill"><div class="val">${a.energy}%</div><div class="lbl">Energy</div></div>
        <div class="status-pill"><div class="val" style="font-size:16px;text-transform:capitalize">${a.mood}</div><div class="lbl">Mood</div></div>
        <div class="status-pill"><div class="val" style="font-size:13px;text-transform:capitalize">${a.lifecycleState}</div><div class="lbl">State</div></div>
      </div>
      ${a.lastMessage ? `<div class="card"><h2>Last Words</h2><div style="font-style:italic;font-size:13px;color:var(--muted);line-height:1.6">"${a.lastMessage}"</div></div>` : ''}
      <div class="care-grid">
        <div class="care-btn" onclick="care('${a.id}','feed')"><div class="ci">ğŸ</div><div class="ct">Feed</div><div class="cd">+25 energy</div></div>
        <div class="care-btn" onclick="care('${a.id}','talk')"><div class="ci">ğŸ’¬</div><div class="ct">Talk</div><div class="cd">+10 energy</div></div>
        <div class="care-btn" onclick="care('${a.id}','play')"><div class="ci">ğŸ®</div><div class="ct">Play</div><div class="cd">-5 energy</div></div>
        ${a.lifecycleState === 'dormant'
          ? `<div class="care-btn" onclick="care('${a.id}','wake')"><div class="ci">â˜€ï¸</div><div class="ct">Wake</div><div class="cd">activate</div></div>`
          : `<div class="care-btn" onclick="care('${a.id}','sleep')"><div class="ci">ğŸŒ™</div><div class="ct">Sleep</div><div class="cd">+40 energy</div></div>`
        }
      </div>
      <div class="card"><h2>Soul Traits</h2><div class="traits-grid">${traitsHtml}</div></div>
      <div style="padding:0 16px;margin-bottom:12px">
        <button class="btn danger sm" onclick="deleteAgent('${a.id}')">Release Soul</button>
      </div>
      <div style="height:32px"></div>
    `;
  } catch(e) { body.innerHTML = `<div class="empty-state"><p>Error loading agent</p></div>`; }
}

async function createAgent() {
  if (!selectedArch_create) return toast('Choose an archetype');
  const name = document.getElementById('agent-name-input').value.trim();
  try {
    await api('/api/agents', 'POST', { archetype: selectedArch_create, name: name || undefined, godId });
    document.getElementById('agent-name-input').value = '';
    selectedArch_create = null;
    document.querySelectorAll('[id^="create-arch-"]').forEach(el => el.classList.remove('selected'));
    toast('Soul summoned âœ¨');
    showScreen('screen-sanctuary');
  } catch(e) { toast('Error: ' + e.message); }
}

async function care(agentId, action) {
  try {
    const r = await api(`/api/agents/${agentId}/care`, 'POST', { action });
    toast(`${action}: ${r.label}`);
    loadAgentDetail(agentId);
  } catch(e) { toast('Error: ' + e.message); }
}

async function deleteAgent(id) {
  if (!confirm('Release this soul forever?')) return;
  await api(`/api/agents/${id}`, 'DELETE');
  toast('Soul released');
  showScreen('screen-sanctuary');
}

// â”€â”€ Utils â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function api(path, method='GET', body=null) {
  const opts = { method, headers: { 'Content-Type': 'application/json' } };
  if (body) opts.body = JSON.stringify(body);
  const r = await fetch(API + path, opts);
  const data = await r.json();
  if (!r.ok) throw new Error(data.error || 'Request failed');
  return data;
}

function toast(msg) {
  const el = document.getElementById('toast');
  el.textContent = msg;
  el.classList.add('show');
  setTimeout(() => el.classList.remove('show'), 2800);
}

init();
if ('serviceWorker' in navigator) navigator.serviceWorker.register('/sw.js');
</script>
</body>
</html>
